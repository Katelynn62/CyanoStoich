---
title: "Final_Submission_Analysis"
author: "Katelynn"
date: "2025-02-17"
output: html_document
---

This document includes the updated figures and analyses as suggested by the accepted manuscript on 12/21/24 for L&O Letters. Primarily, we are fine tuning figures, but we have also removed the RDA from the analysis into the supplementary information, and added wind direction into our correlation analysis for the RDA, as well as on the wind speed figure. 

This will be the final document that we upload onto GitHub. 

# Load and Clean Data
```{r}
library(rLakeAnalyzer)

```

# Manuscript Figure 1 

This figure is the map of our sites.

# Manuscript Figure 2: Phycocyanin vs. Cyanotoxins

The reviewers suggested separating the toxin data and the phycocyanin data into two separate plots. So we will provide both options for the figures here. 

The primary changes we made to this figure from the original were: 
1. Increase font Size on the bloom stages,
2. Separate the figures into 4 panels instead of 2 with double y axes
3. Include chlorophyll on the phycocyanin axis. 

## Phycocyanin

```{r}
# MB

MB_PC <- Toxins_PC %>%
  filter(Station == "MB") %>%
  filter(Date > as.Date("2021-06-01") & Date <= as.Date("2021-11-05")) %>%
  ggplot() + 
  annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-08-07"), ymin = 0, ymax = 10,
           fill = "grey91") +
  annotate(geom="text", angle = 32, x= as.Date("2021-06-06"), y=10.6, label="PrB",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-08-07"), xmax = as.Date("2021-08-12"), ymin = 0, ymax = 10,
           fill = "grey98") +
  annotate(geom="text", angle = 32, x= as.Date("2021-08-10"), y=10.6, label="E1",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-08-12"), xmax = as.Date("2021-08-20"), ymin = 0, ymax = 10,
           fill = "grey91") +
  annotate(geom="text", angle = 32, x= as.Date("2021-08-19"), y=10.6, label="PB1",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-08-22"), xmax = as.Date("2021-08-24"), ymin = 0, ymax = 10,
           fill = "grey98") +
  annotate(geom="text", angle = 32, x= as.Date("2021-08-26"), y=10.6, label="BC1",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-08-24"), xmax = as.Date("2021-09-03"), ymin = 0, ymax = 10,
           fill = "grey91") +
  annotate(geom="text", angle = 32, x= as.Date("2021-09-02"), y=10.6, label="E2",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-09-03"), xmax = as.Date("2021-09-15"), ymin = 0, ymax = 10,
           fill = "grey98") +
  annotate(geom="text", angle = 32, x= as.Date("2021-09-11"), y=10.6, label="PB2",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-09-15"), xmax = as.Date("2021-09-27"), ymin = 0, ymax = 10,
           fill = "grey91") +
  annotate(geom="text", angle = 32, x= as.Date("2021-09-20"), y=10.6, label="BC2",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-09-27"), xmax = as.Date("2021-11-05"), ymin = 0, ymax = 10,
           fill = "grey98") +
  annotate(geom="text", angle=32, x= as.Date("2021-10-01"), y=10.6, label="PoB",
           color="black", size=2.3) +
   geom_line(aes(x = Date, y = PC_RFU), size = 1, color="black", group = 1) + 
  theme_classic() +
  ggtitle("C")+
  labs(title="Missisquoi Bay", subtitle = "(a)", x="", y="Phycocyanin (RFU)")+
  theme(plot.title = element_text(hjust = 0.5, vjust = -3, size=11), 
        plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5), 
        axis.title.y = element_text(size=10), 
        axis.text.y=element_text(size=9),
        axis.title.x = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        legend.title = element_text(size = 10), 
        legend.key.size = unit(0.07, 'in'), 
        legend.text = element_text(size=9),
        legend.position = "none", 
        plot.margin = margin(c(0,0,0,0), unit="cm"))
# -0.1,-1,-0.25,0.05
ggsave("MB_PC.tiff", plot=MB_Tox, device="tiff", width=3, height=2, units="in", dpi=600)


SA_PC <- Toxins_PC %>%
  filter(Station == "SA") %>%
  filter(Date > as.Date("2021-06-01")& Date <= as.Date("2021-11-05")) %>%
  ggplot() + 
  annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-07-11"), ymin = 0, ymax = 10,
           fill = "grey91") +
  annotate(geom="text", angle=32, x= as.Date("2021-06-06"), y=10.6, label="PrB",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-07-11"), xmax = as.Date("2021-07-15"), ymin = 0, ymax = 10,
           fill = "grey98") +
  annotate(geom="text", angle=32, x= as.Date("2021-07-15"), y=10.6, label="BC1",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-07-15"), xmax = as.Date("2021-07-27"), ymin = 0, ymax = 10,
           fill = "grey91") +
  annotate(geom="text", angle=32, x= as.Date("2021-07-23"), y=10.4, label="E",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-07-27"), xmax = as.Date("2021-08-16"), ymin = 0, ymax = 10,
           fill = "grey98") +
  annotate(geom="text", angle=32, x= as.Date("2021-08-01"), y=10.6, label="PB",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-08-17"), xmax = as.Date("2021-08-27"), ymin = 0, ymax = 10,
           fill = "grey91") +
  annotate(geom="text", angle=32, x= as.Date("2021-08-23"), y=10.6, label="BC2",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-08-27"), xmax = as.Date("2021-10-31"), ymin = 0, ymax = 10,
           fill = "grey98") +
  annotate(geom="text", angle=32, x= as.Date("2021-09-04"), y=10.6, label="PoB",
           color="black", size=2.3) +
  geom_line(aes(x = Date, y = PC_RFU), size = 1, color="black", group = 1) + 
  theme_classic() +
  labs(title="St. Albans Bay", subtitle = "(b)", x="", y="", fill="")+
  theme(plot.title = element_text(hjust = 0.5, vjust = -3, size=11), 
        plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
        axis.title.y = element_blank(), 
        axis.text.y=element_text(size=9),
        axis.title.x = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        legend.position = "none", 
        plot.margin = margin(c(0,0,0,0), unit="cm"))

Combined_PC <- ggarrange(MB_PC, SA_PC, align="v", ncol=2, nrow=1)
```
## Cyanotoxin Levels: 

```{r}

MB_Tox <- Toxins_PC %>%
  rename(MC = Microcystin,
         ATX = Anatoxin) %>%
  pivot_longer(cols = c("MC", "ATX"), names_to = "Toxin", values_to = "Value") %>%
  filter(Station == "MB") %>%
  filter(Date > as.Date("2021-06-01") & Date <= as.Date("2021-11-05")) %>%
  ggplot() + 
    annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-08-07"), ymin = 0, ymax = 0.25,
           fill = "grey91") +
    annotate("rect", xmin = as.Date("2021-08-07"), xmax = as.Date("2021-08-12"), ymin = 0, ymax = 0.25,
           fill = "grey98") +
    annotate("rect", xmin = as.Date("2021-08-12"), xmax = as.Date("2021-08-20"), ymin = 0, ymax = 0.25,
           fill = "grey91") +
    annotate("rect", xmin = as.Date("2021-08-20"), xmax = as.Date("2021-08-24"), ymin = 0, ymax = 0.25,
           fill = "grey98") +
    annotate("rect", xmin = as.Date("2021-08-24"), xmax = as.Date("2021-09-03"), ymin = 0, ymax = 0.25,
           fill = "grey91") +
    annotate("rect", xmin = as.Date("2021-09-03"), xmax = as.Date("2021-09-15"), ymin = 0, ymax = 0.25,
           fill = "grey98") +
    annotate("rect", xmin = as.Date("2021-09-15"), xmax = as.Date("2021-09-27"), ymin = 0, ymax = 0.25,
           fill = "grey91") +
    annotate("rect", xmin = as.Date("2021-09-27"), xmax = as.Date("2021-10-31"), ymin = 0, ymax = 0.25,
           fill = "grey98") +
  geom_bar(aes(x = Date, y=Value, fill=Toxin), stat="identity", position="dodge", width=6, alpha=.7) +
  scale_fill_manual(values=c("orangered3", "cadetblue4"))+
  theme_classic() +
  labs(title=NULL, subtitle = "(c)", x=NULL, y=expression(paste("Concentration (",~ mu, "g/L)"))) +
  theme(plot.title = element_blank(), 
        plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5), 
        axis.title = element_text(size=10), axis.text=element_text(size=9), 
        plot.margin = margin(c(0,0,0.5,0), unit="cm"), legend.position = "none")
#-1,-1,1,0.05
# SA

SA_Tox <- Toxins_PC %>%
   rename(MC = Microcystin,
         ATX = Anatoxin) %>%
  pivot_longer(cols = c("MC", "ATX"), names_to = "Toxin", values_to = "Value") %>%
  filter(Station == "SA") %>%
  filter(Date > as.Date("2021-06-01")& Date <= as.Date("2021-11-05")) %>%
  ggplot() + 
   annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-07-11"), ymin = 0, ymax = .25,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-07-11"), xmax = as.Date("2021-07-15"), ymin = 0, ymax = .25,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-07-15"), xmax = as.Date("2021-07-27"), ymin = 0, ymax = .25,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-07-27"), xmax = as.Date("2021-08-16"), ymin = 0, ymax = .25,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-08-16"), xmax = as.Date("2021-08-27"), ymin = 0, ymax = .25,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-27"), xmax = as.Date("2021-10-31"), ymin = 0, ymax = .25,
           fill = "grey98") +
  geom_bar(aes(x = Date, y=Value, fill=Toxin), stat="identity", position="dodge", width=6, alpha=.7) +
  scale_fill_manual(values=c("orangered3", "cadetblue4"))+
  theme_classic() +
  labs(title=NULL, subtitle = "(d)", x=NULL, y=NULL, fill="Toxin")+
  theme(plot.title = element_blank(), 
        plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5), 
        axis.title = element_text(size=10), axis.text=element_text(size=9), 
        plot.margin = margin(c(0,0,0.5,0), unit="cm"),
        legend.title = element_text(size = 10),
        legend.key.size = unit(0.1, 'in'), legend.text = element_text(size=9), 
        legend.position = c(.95, .9), legend.justification = c("right", "top"),
        legend.background = element_rect(linetype = 1, size = 0.25, colour = "black"),
        legend.margin = margin(c(0.25, 0.25, 0.25, 0.25), unit="cm"))
#-1,0.05,1,-1

# ggarrange code for publication

Combined_Tox <- ggarrange(MB_Tox, SA_Tox, align="v", ncol=2, nrow=1)


## Combined all plots: 

Combined_PCTox <- ggarrange(Combined_PC, Combined_Tox, align="hv", ncol=1, nrow=2)

ggsave("MB_SA_ToxPC.tiff", plot=Combined_PCTox, device="tiff", width=6.5, height=5, units="in", dpi=600)


```

# Manuscript Figure 3: Phytoplankton Genera


```{r}
### Making the Phytoplankton Type Figure

Phytos <- read_csv("./Clean Data/Warner_etal_PhytoplanktonBV.csv") %>%
  #filter(Taxonomic_group == "Cyanobacteria") %>%
  select(Sample_ID, SampleDate, Genus, species, BM_ug.L, RA_BM, Taxonomic_group) %>%
  mutate(SampleDate = if_else(Sample_ID == "IP21_074_SA", as.Date("2021-08-26"), SampleDate),
         SampleDate = if_else(Sample_ID == "IP21_065_SA", as.Date("2021-08-13"), SampleDate)) %>%
  mutate(Date = SampleDate) %>%
  mutate(Station = if_else(grepl("MB", Sample_ID), "MB", "SA"), 
         Taxonomic_group = if_else(Taxonomic_group == "UNK", "Unknown", Taxonomic_group))


## Join dataframes together

SA21_Genus <- Phytos %>%
  filter(Station == "SA") %>%
  select(Genus) %>%
  unique()

MB21_Genus <- Phytos %>%
  filter(Station == "MB") %>%
  select(Genus) %>%
  unique()


## Changing this to be the Genera that are at least 10% or greater of the communitity. 


SA_Phyto_Keep <- Phytos %>%
  filter(Station == "SA") %>%
  group_by(Sample_ID, SampleDate, Genus) %>%
  summarize(RA_BM = sum(RA_BM)) %>%
  mutate(Keep = if_else(RA_BM >= 0.10, "Yes", "No")) %>%
  ungroup() %>%
  select(Genus, Keep) %>%
  filter(Keep=="Yes") %>%
  unique()

###############################################################################

```


## Phyto Taxonomic Groups


```{r}
SA21_PhytoFam <- Phytos %>%
  filter(Station == "SA") %>%
  select(SampleDate, Taxonomic_group, BM_ug.L) %>%
  group_by(SampleDate, Taxonomic_group) %>%
  summarise(BM = sum(BM_ug.L)) %>%
  filter(SampleDate > as.Date("2021-06-01")) %>%
  rename(Date = SampleDate) %>%
  group_by(Date) %>%
  arrange(desc(BM))

unique(SA21_PhytoFam$Taxonomic_group)

# Figure for SA. 

SA_21 <- SA21_PhytoFam %>%
  ggplot(aes(fill = reorder(Taxonomic_group, desc(BM)), y=BM, x=as.Date(Date))) + 
annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-07-11"), ymin = 0, ymax = 20000,
           fill = "grey91") +
  annotate(geom="text", angle=32, x= as.Date("2021-06-06"), y=20700, label="PrB",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-07-11"), xmax = as.Date("2021-07-15"), ymin = 0, ymax = 20000,
           fill = "grey98") +
  annotate(geom="text", angle=32, x= as.Date("2021-07-15"), y=20700, label="BC1",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-07-15"), xmax = as.Date("2021-07-27"), ymin = 0, ymax = 20000,
           fill = "grey91") +
  annotate(geom="text", angle=32, x= as.Date("2021-07-23"), y=20700, label="E",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-07-27"), xmax = as.Date("2021-08-16"), ymin = 0, ymax = 20000,
           fill = "grey98") +
  annotate(geom="text", angle=32, x= as.Date("2021-08-01"), y=20700, label="PB",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-08-17"), xmax = as.Date("2021-08-27"), ymin = 0, ymax = 20000,
           fill = "grey91") +
  annotate(geom="text", angle=32, x= as.Date("2021-08-23"), y=20700, label="BC2",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-08-27"), xmax = as.Date("2021-11-30"), ymin = 0, ymax = 20000,
           fill = "grey98") +
  annotate(geom="text", angle=32, x= as.Date("2021-09-04"), y=20700, label="PoB",
           color="black", size=2.3) +
  geom_bar(stat="identity", position="stack", show.legend = TRUE) +
  theme(axis.text.x = element_text(angle=45, hjust=1)) +
  labs(fill='Taxonomic Group', y=NULL, x=NULL, title = "St. Albans Bay", subtitle = "(b)") +
  scale_fill_manual(
    values = c("chocolate", "chartreuse2", "gold2","darkorange4","deepskyblue4", "green4", "darksalmon",
               "bisque4", "gold4", "burlywood3" ,"azure4", "darkgoldenrod"),
    limits = c("Bacillariophyta", "Chlorophyta","Chrysophyta","Cryptophyta","Cyanobacteria","Desmidiaceae","Dinophyceae", "Euglenophyceae",
               "Ochrophyta", "Prymnesiaceae", "Unknown","Xanthophyceae"), 
    drop = FALSE) +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, vjust = -3, size=13), 
        plot.subtitle = element_text(size=12, hjust=0, vjust = -0.5), 
        axis.title.y = element_blank(), 
        axis.text.y =element_text(size=11, margin = margin(0,0,0,0, unit="in")),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.title.x = element_blank(),
        plot.margin = margin(c(0,-0.1,0,0), unit="cm"),
        legend.title = element_text(size = 10), 
        legend.key.size = unit(0.1, 'in'), legend.text = element_text(size=9),
        legend.margin = margin(0.05,0.05,0.05,0.05, unit="cm"), 
        legend.position = c(0.82, 0.66), legend.background = element_rect(fill="white", linewidth = 0.5, color="black")) +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 5)) +
  scale_x_continuous(limits=c(as.Date("2021-06-01"), as.Date("2021-11-30")), breaks = c(as.Date("2021-06-01"), as.Date("2021-07-01"), as.Date("2021-08-01"), as.Date("2021-09-01"), as.Date("2021-10-01"), as.Date("2021-11-01")), labels=c("Jun", "Jul", "Aug", "Sep", "Oct", "Nov"))




## Phyto Taxonomic Groups

MB21_PhytoFam <- Phytos %>%
  filter(Station == "MB") %>%
  select(SampleDate, Taxonomic_group, BM_ug.L) %>%
  group_by(SampleDate, Taxonomic_group) %>%
  summarise(BM = sum(BM_ug.L)) %>%
  filter(SampleDate > as.Date("2021-06-01")) %>%
  rename(Date = SampleDate) %>%
  group_by(Date) %>%
  arrange(desc(BM))


unique(MB21_PhytoFam$Taxonomic_group)


MB_21<- MB21_PhytoFam %>%
  ggplot(aes(fill = reorder(Taxonomic_group, desc(BM)), y=BM, x=as.Date(Date))) + 
    annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-08-07"), ymin = 0, ymax = 55000,
           fill = "grey91") +
  annotate(geom="text", angle = 32, x= as.Date("2021-06-06"), y=57000, label="PrB",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-08-07"), xmax = as.Date("2021-08-12"), ymin = 0, ymax = 55000,
           fill = "grey98") +
  annotate(geom="text", angle = 32, x= as.Date("2021-08-10"), y=57000, label="E1",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-08-12"), xmax = as.Date("2021-08-20"), ymin = 0, ymax = 55000,
           fill = "grey91") +
  annotate(geom="text", angle = 32, x= as.Date("2021-08-18"), y=57000, label="PB1",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-08-22"), xmax = as.Date("2021-08-24"), ymin = 0, ymax = 55000,
           fill = "grey98") +
  annotate(geom="text", angle = 32, x= as.Date("2021-08-26"), y=57000, label="BC1",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-08-24"), xmax = as.Date("2021-09-03"), ymin = 0, ymax = 55000,
           fill = "grey91") +
  annotate(geom="text", angle = 32, x= as.Date("2021-09-02"), y=57000, label="E2",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-09-03"), xmax = as.Date("2021-09-15"), ymin = 0, ymax = 55000,
           fill = "grey98") +
  annotate(geom="text", angle = 32, x= as.Date("2021-09-11"), y=57000, label="PB2",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-09-15"), xmax = as.Date("2021-09-27"), ymin = 0, ymax = 55000,
           fill = "grey91") +
  annotate(geom="text", angle = 32, x= as.Date("2021-09-21"), y=57000, label="BC2",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-09-27"), xmax = as.Date("2021-11-30"), ymin = 0, ymax = 55000,
           fill = "grey98") +
  annotate(geom="text", angle=32, x= as.Date("2021-10-02"), y=57000, label="PoB",
           color="black", size=2.3) +
 geom_bar(stat="identity", position="stack", show.legend = TRUE) +
  theme(axis.text.x = element_text(angle=45, hjust=1)) +
  labs(fill='Taxonomic Group', y=expression(paste("Biovolume (",~ mu, "g/L)")), x="", title = "Missisquoi Bay", subtitle = "(a)") +
  scale_fill_manual(
    values = c("chocolate", "chartreuse2", "gold2","darkorange4","deepskyblue4", "green4", "darksalmon",
               "bisque4", "gold4", "burlywood3" ,"azure4", "darkgoldenrod"),
    limits = c("Bacillariophyta", "Chlorophyta","Chrysophyta","Cryptophyta","Cyanobacteria","Desmidiaceae","Dinophyceae", "Euglenophyceae",
               "Ochrophyta", "Prymnesiaceae", "Unknown","Xanthophyceae"), 
    drop = FALSE) +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5, vjust = -3, size=13), 
        plot.subtitle = element_text(size=12, hjust=0, vjust = -0.5), 
        axis.title.y = element_text(size=12), 
        axis.text.y =element_text(size=11), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.title.x = element_blank(),
        plot.margin = margin(c(0,0,0,0.1), unit="cm"),
        legend.position = "none") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 5)) +
  scale_x_continuous(limits=c(as.Date("2021-06-01"), as.Date("2021-11-30")), breaks = c(as.Date("2021-06-01"), as.Date("2021-07-01"), as.Date("2021-08-01"), as.Date("2021-09-01"), as.Date("2021-10-01"), as.Date("2021-11-01")), labels=c("Jun", "Jul", "Aug", "Sep", "Oct", "Nov"))


### Combined Plot

Combined_PhytoGroup <- ggarrange(MB_21, SA_21, align="v", ncol=2, nrow=1)

```

## Dominant Genera
```{r}

## Major Phytoplankton Groups

SA21_PhytoDom <- Phytos %>%
  filter(Station == "SA") %>%
  select(SampleDate, Genus, BM_ug.L, RA_BM) %>%
  group_by(SampleDate, Genus) %>%
  summarise(BM = sum(BM_ug.L),
            RA_BM = sum(RA_BM)) %>%
  mutate(Algal_Group = if_else(RA_BM > .2, Genus, "Other")) %>%
  filter(SampleDate > as.Date("2021-06-01")) %>%
  rename(Date = SampleDate) %>%
  group_by(Date) %>%
  arrange(desc(BM))

SA21_PhytoDom <- SA21_PhytoDom %>%
  mutate(Genus1 = if_else(Genus == "Microcystis" | Genus == "Dolichospermum" | Genus == "Aphanocapsa" |
                            Genus == "Gyrosigma" | Genus == "Aulacoseira", Genus, "Other"))

SA_21_Dom <- SA21_PhytoDom %>%
  ggplot(aes(fill = reorder(Genus1, desc(BM)), y=BM, x=as.Date(Date))) + 
  annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-07-11"), ymin = 0, ymax = 20000,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-07-11"), xmax = as.Date("2021-07-15"), ymin = 0, ymax =20000,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-07-15"), xmax = as.Date("2021-07-27"), ymin = 0, ymax = 20000,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-07-27"), xmax = as.Date("2021-08-16"), ymin = 0, ymax = 20000,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-08-16"), xmax = as.Date("2021-08-27"), ymin = 0, ymax = 20000,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-27"), xmax = as.Date("2021-11-30"), ymin = 0, ymax = 20000,
           fill = "grey98") +
  geom_bar(stat="identity", position="stack", show.legend=TRUE) +
  theme(axis.text.x = element_text(angle=45, hjust=1)) +
 labs(fill='Genera', y="", x="", subtitle = "(d)", title=NULL) +
  scale_fill_manual(
    values = c("darkseagreen", "navy","chocolate","burlywood4","aquamarine4", "cyan3",  "tan2", "deepskyblue4","azure4", "indianred4","goldenrod2"),
    limits = c("Aphanizomenon", "Aphanocapsa","Aulacoseira","Cryptomonas","Dolichospermum", "Gloeotrichia",  "Gyrosigma", "Microcystis",  "Other",   "Peridiniopsis","Pinnularia"), 
    drop = T) +
 theme_classic() +
  theme(plot.title = element_blank(),
        plot.subtitle = element_text(size=12, hjust=0, vjust = -0.5), 
        axis.title = element_blank(), 
        axis.text =element_text(size=11), 
        plot.margin = margin(c(0,-0.1,0.5,0), unit="cm"),
        legend.title = element_text(size = 10), 
        legend.key.size = unit(0.1, 'in'), legend.text = element_text(size=9),
        legend.margin = margin(0.05,0.05,0.05,0.05, unit="cm"), 
        legend.position = c(0.82, 0.69), legend.background = element_rect(fill="white", linewidth = 0.5, color="black")) +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 5)) +
  scale_x_continuous(limits=c(as.Date("2021-06-01"), as.Date("2021-11-30")), breaks = c(as.Date("2021-06-01"), as.Date("2021-07-01"), as.Date("2021-08-01"), as.Date("2021-09-01"), as.Date("2021-10-01"), as.Date("2021-11-01")), labels=c("Jun", "Jul", "Aug", "Sep", "Oct", "Nov"))

## Miss Bay

MB21_PhytoDom <- Phytos %>%
  filter(Station == "MB") %>%
  select(SampleDate, Genus, BM_ug.L, RA_BM) %>%
  group_by(SampleDate, Genus) %>%
  summarise(BM = sum(BM_ug.L),
            RA_BM = sum(RA_BM)) %>%
  mutate(Algal_Group = if_else(RA_BM > .2, Genus, "Other")) %>%
  filter(SampleDate > as.Date("2021-06-01")) %>%
  rename(Date = SampleDate) %>%
  group_by(Date) %>%
  arrange(desc(BM))

MB21_PhytoDom <- MB21_PhytoDom %>%
  mutate(Genus1 = if_else(Genus == "Gloeotrichia" | Genus == "Dolichospermum" | Genus == "Aphanizomenon" |
                            Genus == "Pinnularia" | Genus == "Aulacoseira" | Genus == "Peridiniopsis" | Genus == "Cryptomonas",
                          Genus, "Other"))

MB_21_Dom <- MB21_PhytoDom %>%
  ggplot(aes(fill = reorder(Algal_Group, desc(BM)), y=BM, x=as.Date(Date))) + 
  annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-08-07"), ymin = 0, ymax = 55000,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-07"), xmax = as.Date("2021-08-12"), ymin = 0, ymax = 55000,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-08-12"), xmax = as.Date("2021-08-20"), ymin = 0, ymax = 55000,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-22"), xmax = as.Date("2021-08-24"), ymin = 0, ymax = 55000,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-08-24"), xmax = as.Date("2021-09-03"), ymin = 0, ymax = 55000,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-09-03"), xmax = as.Date("2021-09-15"), ymin = 0, ymax = 55000,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-09-15"), xmax = as.Date("2021-09-27"), ymin = 0, ymax = 55000,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-09-27"), xmax = as.Date("2021-11-30"), ymin = 0, ymax = 55000,
           fill = "grey98") +
  geom_bar(position="stack", stat="identity", show.legend = TRUE) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle=45, hjust=1)) +
labs(fill='Genera', y=expression(paste("Biovolume (",~ mu, "g/L)")), x="", subtitle = "(c)") +
  scale_fill_manual(
    values = c("darkseagreen", "navy","chocolate","burlywood4","aquamarine4", "cyan3",  "tan2", "deepskyblue4","azure4", "indianred4","goldenrod2"),
    limits = c("Aphanizomenon", "Aphanocapsa","Aulacoseira","Cryptomonas","Dolichospermum", "Gloeotrichia",  "Gyrosigma", "Microcystis",  "Other",   "Peridiniopsis","Pinnularia"), 
    drop = T) +
  theme_classic()+
theme(plot.title = element_blank(), 
      plot.subtitle = element_text(size=12, hjust=0, vjust = -0.5), 
      axis.title.y = element_text(size=12), 
      axis.title.x = element_blank(),
      axis.text=element_text(size=11), 
      plot.margin = margin(0,0,0.5,0.1, unit="cm"),
      legend.position = "none") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 5)) +
  scale_x_continuous(limits=c(as.Date("2021-06-01"), as.Date("2021-11-30")), breaks = c(as.Date("2021-06-01"), as.Date("2021-07-01"), as.Date("2021-08-01"), as.Date("2021-09-01"), as.Date("2021-10-01"), as.Date("2021-11-01")), labels=c("Jun", "Jul", "Aug", "Sep", "Oct", "Nov"))


################################################################################
################################################################################

### Combined Plot

Combined_PhytoGenera <- ggarrange(MB_21_Dom, SA_21_Dom, align="v", ncol=2, nrow=1)

ggsave("MB_SA_PhytoGenera.tiff", plot=Combined_PhytoGenera, device="tiff", width=8, height=3, units="in", dpi=600)


## Combined all plots: 

Combined_Phytos <- ggarrange(Combined_PhytoGroup, Combined_PhytoGenera, align="hv", ncol=1, nrow=2)

ggsave("MB_SA_PhytosAll.tiff", plot=Combined_Phytos, device="tiff", width=8, height=6, units="in", dpi=600)


```



# Manuscript Figure 4: Weather and Physical Water Conditions 

The main edits that need to be made here are: 
* increase line size on figure C and D
* Add wind direction figure?
* Only label top figure with the Bloom Stages: 
* Remove the x-axis between each figure to create a seamless flow.

I think it would also be better to do daily averages here to make the visualizations smoother. 

### Missisquoi Bay


#### Temperature

```{r}
MB_Profiler <- read_csv("./Clean Data/MB_Profiler_2021_Clean.csv") %>%
  filter(Month >= 6 & Month < 11) %>%
  mutate(Date = make_date(Year, Month, Day)) %>%
  mutate(Group = if_else(Date >= as.Date("2021-06-15") & Date <= as.Date("2021-06-23"), 1, 0),
         Group = if_else(Date == as.Date("2021-06-25"), 2, Group),
         Group = if_else(Date >= as.Date("2021-06-28") & Date <= as.Date("2021-07-03"), 3, Group),
         Group = if_else(Date >= as.Date("2021-07-06") & Date <= as.Date("2021-07-15"), 4, Group),
         Group = if_else(Date >= as.Date("2021-07-17") & Date <= as.Date("2021-08-21"), 5, Group),
         Group = if_else(Date >= as.Date("2021-08-23") & Date <= as.Date("2021-09-04"), 6, Group),
         Group = if_else(Date >= as.Date("2021-09-06") & Date <= as.Date("2021-09-08"), 7, Group),
         Group = if_else(Date >= as.Date("2021-09-10") & Date <= as.Date("2021-10-01"), 8, Group),
         Group = if_else(Date >= as.Date("2021-10-03") & Date <= as.Date("2021-10-05"), 9, Group),
         Group = if_else(Date >= as.Date("2021-10-07") & Date <= as.Date("2021-10-15"), 10, Group),
         Group = if_else(Date >= as.Date("2021-10-18") & Date <= as.Date("2021-10-22"), 11, Group),
         Group = if_else(Date >= as.Date("2021-10-24") & Date <= as.Date("2021-10-25"), 12, Group),
         Group = if_else(Date >= as.Date("2021-10-27") & Date <= as.Date("2021-10-31"), 13, Group)) %>%
  select(-Remove) %>%
  group_by(Date, Depth, Month, Day, Year, Group) %>%
  summarise(Temp_C = mean(Temp_C),
            ODOmgL = mean(ODOmgL))



MB_Temp <- MB_Profiler %>%
  select(Date, Depth, Temp_C, Month, Day, Year, Group) %>%
  filter(Depth == 1.0 | Depth == 2.5) %>%
  mutate(Depth = as.character(Depth)) %>%
  ggplot(aes(x=Date, y=Temp_C, color=Depth, group=Group)) +
       annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-08-07"), ymin = 10, ymax = 30,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-07"), xmax = as.Date("2021-08-12"), ymin = 10, ymax =30,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-08-12"), xmax = as.Date("2021-08-20"), ymin = 10, ymax =30,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-20"), xmax = as.Date("2021-08-24"), ymin = 10, ymax =30,
           fill = "grey98") +
    annotate("rect", xmin = as.Date("2021-08-24"), xmax = as.Date("2021-09-03"), ymin = 10, ymax =30,
           fill = "grey91") +
    annotate("rect", xmin = as.Date("2021-09-03"), xmax = as.Date("2021-09-15"), ymin = 10, ymax =30,
           fill = "grey98") +
    annotate("rect", xmin = as.Date("2021-09-15"), xmax = as.Date("2021-09-27"), ymin = 10, ymax =30,
           fill = "grey91") +
    annotate("rect", xmin = as.Date("2021-09-27"), xmax = as.Date("2021-10-31"), ymin = 10, ymax =30,
           fill = "grey98") +
   annotate(geom="text", x= as.Date("2021-06-06"), y=32, label="PrB",
           color="black", size=2.3, angle=32) +
  annotate(geom="text", x= as.Date("2021-08-10"), y=32, label="E1",
           color="black", size=2.3, angle=32) +
  annotate(geom="text", x= as.Date("2021-08-19"), y=32, label="PB1",
           color="black", size=2.3, angle=32) +
  annotate(geom="text", x= as.Date("2021-08-26"), y=32, label="BC1",
           color="black", size=2.3, angle=32) +
  annotate(geom="text", x= as.Date("2021-09-02"), y=32, label="E2",
           color="black", size=2.3, angle=32) +
  annotate(geom="text", x= as.Date("2021-09-11"), y=32, label="PB2",
           color="black", size=2.3, angle=32) +
  annotate(geom="text", x= as.Date("2021-09-20"), y=32, label="BC2",
           color="black", size=2.3, angle=32) +
  annotate(geom="text", x= as.Date("2021-10-01"), y=32, label="PoB",
           color="black", size=2.3, angle=32) +
  geom_line(linewidth=0.75, alpha=0.7) + 
  scale_color_manual(values=c("orangered3", "dodgerblue3"))+
  theme_classic() +
  ylim(10,32) +
  labs(y= "Water Temperature (C)", x=NULL, title="Missisquoi Bay", subtitle = "(a)") +
   theme(plot.title = element_text(hjust = 0.5, vjust = -3, size=11), 
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_text(size=10), 
         axis.text.y =element_text(size=9),
         axis.title.x = element_blank(),
         axis.text.x = element_blank(),
         axis.ticks.x = element_blank(),
         legend.title = element_text(size = 10), 
         legend.key.size = unit(0.07, 'in'), legend.text = element_text(size=9), legend.position = "none",
         plot.margin = margin(c(0,0,0,0), unit="cm"))


```

```{r}

MB_DO <- MB_Profiler %>%
  select(Depth, Date, ODOmgL, Month, Day, Year, Group) %>%
  filter(Depth == 1.0 | Depth == 2.5) %>%
  mutate(Depth = as.character(Depth)) %>%
  ggplot(aes(x=Date, y=ODOmgL, color=Depth, group=Group)) +
      annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-08-07"), ymin = 0, ymax = 15,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-07"), xmax = as.Date("2021-08-12"), ymin = 0, ymax =15,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-08-12"), xmax = as.Date("2021-08-20"), ymin = 0, ymax =15,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-20"), xmax = as.Date("2021-08-24"), ymin = 0, ymax =15,
           fill = "grey98") +
    annotate("rect", xmin = as.Date("2021-08-24"), xmax = as.Date("2021-09-03"), ymin = 0, ymax =15,
           fill = "grey91") +
    annotate("rect", xmin = as.Date("2021-09-03"), xmax = as.Date("2021-09-15"), ymin = 0, ymax =15,
           fill = "grey98") +
    annotate("rect", xmin = as.Date("2021-09-15"), xmax = as.Date("2021-09-27"), ymin = 0, ymax =15,
           fill = "grey91") +
    annotate("rect", xmin = as.Date("2021-09-27"), xmax = as.Date("2021-10-31"), ymin = 0, ymax =15,
           fill = "grey98") +
  geom_line(linewidth=0.75, alpha=0.7) + 
  scale_color_manual(values=c("orangered3", "dodgerblue3"))+
  theme_classic() +
  labs(y= "Dissolved Oxygen (mg/L)", x=NULL, title=NULL, subtitle = "(c)") +
  ylim(0,15) +
   theme(plot.title = element_blank(), 
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_text(size=10), 
         axis.text.y =element_text(size=9),
         axis.title.x = element_blank(),
         axis.text.x = element_blank(),
         axis.ticks.x = element_blank(),
         legend.title = element_text(size = 10), 
         legend.key.size = unit(0.07, 'in'), legend.text = element_text(size=9), legend.position = "none",
         plot.margin = margin(c(0,0,0,0), unit="cm"))



```


#### Stability

```{r}
library(rLakeAnalyzer)

MB_bathy <- approx.bathy(Zmax = 5.0, lkeArea= 78000000, Zmean = 2.8, method = "voldev", zinterval = 0.5) #Approximates bathymetry (Cone or Voldev)

names(MB_bathy)[2] <- "areas" #Needs this column name to work with rlakeanalyzer

MB_Schmidt <- MB_Profiler %>%
  select(Depth, Date, Temp_C, Month, Day, Year, Group) %>%
  group_by(Date, Group) %>%
  mutate(SS = schmidt.stability(wtr = Temp_C, depths = Depth, bthA = MB_bathy$areas, bthD = MB_bathy$depths)) %>%
  select(Date, SS, Group) %>%
  unique()

MB_SS <- MB_Schmidt %>%
  filter(SS > -100) %>%
  ggplot(aes(x=Date, y=SS, group=Group)) +
      annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-08-07"), ymin = 0, ymax = 20,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-07"), xmax = as.Date("2021-08-12"), ymin = 0, ymax =20,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-08-12"), xmax = as.Date("2021-08-20"), ymin = 0, ymax =20,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-20"), xmax = as.Date("2021-08-24"), ymin = 0, ymax =20,
           fill = "grey98") +
    annotate("rect", xmin = as.Date("2021-08-24"), xmax = as.Date("2021-09-03"), ymin = 0, ymax =20,
           fill = "grey91") +
    annotate("rect", xmin = as.Date("2021-09-03"), xmax = as.Date("2021-09-15"), ymin = 0, ymax =20,
           fill = "grey98") +
    annotate("rect", xmin = as.Date("2021-09-15"), xmax = as.Date("2021-09-27"), ymin = 0, ymax =20,
           fill = "grey91") +
    annotate("rect", xmin = as.Date("2021-09-27"), xmax = as.Date("2021-10-31"), ymin = 0, ymax =20,
           fill = "grey98") +
  geom_line()+
  theme_classic()+ 
  labs(y= bquote('Schmidt Stability (J/m'^2~")"), x=NULL, subtitle = "(e)", title=NULL) +
  ylim(0,21)+
  theme(plot.title = element_blank(), 
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_text(size=10), 
         axis.text.y =element_text(size=9),
         axis.title.x = element_blank(),
         axis.text.x = element_blank(),
         axis.ticks.x = element_blank(),
         legend.title = element_text(size = 10), 
         legend.key.size = unit(0.07, 'in'), legend.text = element_text(size=9), legend.position = "none",
         plot.margin = margin(c(0,0,0,0), unit="cm"))

```

#### Stream Gauge Flow
```{r}
Precip_Data_MR <- importRDB1("https://nwis.waterservices.usgs.gov/nwis/iv/?sites=04294000&parameterCd=00060&startDT=2017-06-01T00:00:00.000-04:00&endDT=2021-10-31T23:59:59.999-04:00&siteStatus=all&format=rdb") %>%
  mutate(Year = year(datetime),
         Month = month(datetime),
         Day = day(datetime)) %>%
  group_by(Day, Month, Year) %>%
  summarise(Avg_SF = mean(X67399_00060)) %>%
  mutate(Date = make_date(Year, Month, Day)) %>%
  filter(Month >= 6 & Month <= 11 & Year == 2021)


Precip_Data_RR <- importRDB1("https://nwis.waterservices.usgs.gov/nwis/iv/?sites=04294140&parameterCd=00060&startDT=2017-06-01T00:00:00.000-04:00&endDT=2021-10-31T23:59:59.999-04:00&siteStatus=all&format=rdb") %>%
  mutate(Year = year(datetime),
         Month = month(datetime),
         Day = day(datetime)) %>%
  group_by(Day, Month, Year) %>%
  summarise(Avg_SF = mean(X67402_00060)) %>%
  mutate(Date = make_date(Year, Month, Day)) %>%
  filter(Month >= 6 & Month <= 11 & Year == 2021)


Precip_Data_MB <- full_join(Precip_Data_RR, Precip_Data_MR) %>%
  group_by(Day, Month, Year, Date) %>%
  summarise(Sum_SF = sum(Avg_SF))


MB_SF <- Precip_Data_MB %>%
  ggplot(aes(x=Date, y=Sum_SF))+
   annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-08-07"), ymin = 0, ymax = 2500,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-07"), xmax = as.Date("2021-08-12"), ymin = 0, ymax =2500,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-08-12"), xmax = as.Date("2021-08-20"), ymin = 0, ymax = 2500,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-20"), xmax = as.Date("2021-08-24"), ymin = 0, ymax = 2500,
           fill = "grey98") +
    annotate("rect", xmin = as.Date("2021-08-24"), xmax = as.Date("2021-09-03"), ymin = 0, ymax = 2500,
           fill = "grey91") +
    annotate("rect", xmin = as.Date("2021-09-03"), xmax = as.Date("2021-09-15"), ymin = 0, ymax = 2500,
           fill = "grey98") +
    annotate("rect", xmin = as.Date("2021-09-15"), xmax = as.Date("2021-09-27"), ymin = 0, ymax = 2500,
           fill = "grey91") +
    annotate("rect", xmin = as.Date("2021-09-27"), xmax = as.Date("2021-10-31"), ymin = 0, ymax = 2500,
           fill = "grey98") +
  geom_line()+
  theme_classic()+ 
  labs(y= bquote('Stream Gauge Flow (ft'^3~"/s)"), x=NULL, subtitle = "(i)", title=NULL) +
  ylim(0,2500)+
  theme(plot.title = element_blank(), 
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_text(size=10), 
         axis.text =element_text(size=9),
         axis.title.x = element_blank(),
         legend.title = element_text(size = 10), 
         legend.key.size = unit(0.07, 'in'), legend.text = element_text(size=9), legend.position = "none",
         plot.margin = margin(c(0,0,0.5,0), unit="cm"))


```


#### Wind Speed and Direction
```{r}
MB_Met <- read_csv("./Clean Data/MB_Met_Clean.csv") %>%
  select(Year, Month, Day, Datetime, Wind_Direction, Wind_Speed, Temperature, PAR, Temp1) %>%
  filter(Year == 2021) %>%
  mutate(Date = make_date(Year, Month, Day)) %>%
  mutate(Group = if_else(Date < as.Date("2021-09-30"), 1, 0),
         Group = if_else(Date >= as.Date("2021-10-11"), 2, Group)) %>%
  filter(Group != 0)

library(ggformula)



dat <- MB_Met %>%
  mutate(Radians = Wind_Direction * (pi/180)) %>%
  group_by(Date) %>%
  summarise(Wind_Speed = mean(Wind_Speed),
            Wind_Direction = mean(Wind_Direction), 
            Group = mean(Group), Month = mean(Month)) %>%
  filter(Wind_Speed > 0)

MB_Wind <- dat %>%
  filter(Month>=6 & Month < 11) %>%
  ggplot(aes(x=Date, y=Wind_Speed, group=Group)) +
   annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-08-07"), ymin = 0, ymax = 8,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-07"), xmax = as.Date("2021-08-12"), ymin = 0, ymax =8,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-08-12"), xmax = as.Date("2021-08-20"), ymin = 0, ymax =8,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-20"), xmax = as.Date("2021-08-24"), ymin = 0, ymax =8,
           fill = "grey98") +
    annotate("rect", xmin = as.Date("2021-08-24"), xmax = as.Date("2021-09-03"), ymin = 0, ymax =8,
           fill = "grey91") +
    annotate("rect", xmin = as.Date("2021-09-03"), xmax = as.Date("2021-09-15"), ymin = 0, ymax =8,
           fill = "grey98") +
    annotate("rect", xmin = as.Date("2021-09-15"), xmax = as.Date("2021-09-27"), ymin = 0, ymax =8,
           fill = "grey91") +
    annotate("rect", xmin = as.Date("2021-09-27"), xmax = as.Date("2021-10-31"), ymin = 0, ymax =8,
           fill = "grey98") +
  geom_line(alpha=0.7) + 
  geom_text(aes(angle=-Wind_Direction+90), label=expression(paste("\U27A4")), color="black", size=3) +
  theme_classic() +
  labs(x=NULL, y="Wind Speed (m/s)", subtitle="(g)", title=NULL) +
  ylim(0,8) +
  theme(plot.title = element_blank(), 
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_text(size=10), 
         axis.text.y =element_text(size=9),
         axis.title.x = element_blank(),
         axis.text.x = element_blank(),
         axis.ticks.x = element_blank(),
         legend.title = element_text(size = 10), 
         legend.key.size = unit(0.07, 'in'), legend.text = element_text(size=9), legend.position = "none",
         plot.margin = margin(c(0,0,0,0), unit="cm"))
  
  
MB_Temp_DO_SS_Wind_SF <- ggarrange(MB_Temp, MB_DO, MB_SS, MB_Wind, MB_SF, align="v", ncol=1, nrow=5)

ggsave("MB_Temp_DO_SS_Wind_SF.tiff", plot=MB_Temp_DO_SS_Wind_SF, device="tiff", width=4, height=10, units="in", dpi=600)

```

## St. Albans Figures
#### Temperature

```{r}
SA_Profiler <- read_csv("./Clean Data/SA_Profiler_2021_Clean.csv") %>%
  filter(Month >= 6 & Month < 11) %>%
  mutate(Date = make_date(Year, Month, Day)) %>%
  mutate(Group = if_else(Date >= as.Date("2021-06-17") & Date <= as.Date("2021-08-20"), 1, 0),
         Group = if_else(Date >= as.Date("2021-08-21") & Date <= as.Date("2021-09-06"), 2, Group),
         Group = if_else(Date >= as.Date("2021-09-08") & Date <= as.Date("2021-10-01"), 3, Group),
         Group = if_else(Date == as.Date("2021-10-04"), 4, Group),
         Group = if_else(Date >= as.Date("2021-10-06") & Date <= as.Date("2021-10-14"), 5, Group),
         Group = if_else(Date >= as.Date("2021-10-18") & Date <= as.Date("2021-10-21"), 6, Group),
         Group = if_else(Date >= as.Date("2021-10-23") & Date <= as.Date("2021-10-25"), 7, Group),
         Group = if_else(Date >= as.Date("2021-10-28") & Date <= as.Date("2021-10-30"), 8, Group)) %>%
  select(-Remove) %>%
  group_by(Date, Depth, Month, Day, Year, Group) %>%
  summarise(Temp_C = mean(Temp_C),
            ODOmgL = mean(ODOmgL))



SA_Temp <- SA_Profiler %>%
  select(Date, Depth, Temp_C, Month, Day, Year, Group) %>%
  filter(Depth == 0.5 | Depth == 4.5) %>%
  mutate(Depth = as.character(Depth)) %>%
  ggplot(aes(x=Date, y=Temp_C, color=Depth, group=Group)) +
 annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-07-11"), ymin = 10, ymax = 30,
           fill = "grey91") +
  annotate(geom="text", angle=32, x= as.Date("2021-06-06"), y=32, label="PrB",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-07-11"), xmax = as.Date("2021-07-15"), ymin = 10, ymax = 30,
           fill = "grey98") +
  annotate(geom="text", angle=32, x= as.Date("2021-07-15"), y=32, label="BC1",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-07-15"), xmax = as.Date("2021-07-27"), ymin = 10, ymax = 30,
           fill = "grey91") +
  annotate(geom="text", angle=32, x= as.Date("2021-07-23"), y=32, label="E",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-07-27"), xmax = as.Date("2021-08-16"), ymin = 10, ymax = 30,
           fill = "grey98") +
  annotate(geom="text", angle=32, x= as.Date("2021-08-01"), y=32, label="PB",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-08-17"), xmax = as.Date("2021-08-27"), ymin = 10, ymax = 30,
           fill = "grey91") +
  annotate(geom="text", angle=32, x= as.Date("2021-08-23"), y=32, label="BC2",
           color="black", size=2.3) +
  annotate("rect", xmin = as.Date("2021-08-27"), xmax = as.Date("2021-10-31"), ymin = 10, ymax = 30,
           fill = "grey98") +
  annotate(geom="text", angle=32, x= as.Date("2021-09-04"), y=32, label="PoB",
           color="black", size=2.3) +
  geom_line(linewidth=0.75, alpha=0.7) + 
  scale_color_manual(values=c("orangered3", "dodgerblue3"), labels=c("Surface", "Bottom"))+
  theme_classic() +
  ylim(10,32) +
  labs(y= NULL, x=NULL, title="St.Albans Bay", subtitle = "(b)") +
   theme(plot.title = element_text(hjust = 0.5, vjust = -3, size=11), 
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_blank(), 
         axis.text.y =element_text(size=9),
         axis.title.x = element_blank(),
         axis.text.x = element_blank(),
         axis.ticks.x = element_blank(),
         plot.margin = margin(c(0,0,0,0), unit="cm"), 
         legend.title = element_text(size = 10),
         legend.key.size = unit(0.1, 'in'), legend.text = element_text(size=9), 
         legend.position = c(.95, .95), legend.justification = c("right", "top"),
         legend.background = element_rect(linetype = 1, size = 0.25, colour = "black"),
         legend.margin = margin(c(0.15, 0.15, 0.15, 0.15), unit="cm"))


```

```{r}

SA_DO <- SA_Profiler %>%
  select(Depth, Date, ODOmgL, Month, Day, Year, Group) %>%
  filter(Depth == 0.5 | Depth == 4.5) %>%
  mutate(Depth = as.character(Depth)) %>%
  ggplot(aes(x=Date, y=ODOmgL, color=Depth, group=Group)) +
  annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-07-11"), ymin = 0, ymax = 15,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-07-11"), xmax = as.Date("2021-07-15"), ymin = 0, ymax = 15,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-07-15"), xmax = as.Date("2021-07-27"), ymin = 0, ymax = 15,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-07-27"), xmax = as.Date("2021-08-16"), ymin = 0, ymax = 15,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-08-17"), xmax = as.Date("2021-08-27"), ymin = 0, ymax = 15,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-27"), xmax = as.Date("2021-10-31"), ymin = 0, ymax = 15,
           fill = "grey98") +
  geom_line(linewidth=0.75, alpha=0.7) + 
  scale_color_manual(values=c("orangered3", "dodgerblue3"))+
  theme_classic() +
  labs(y= NULL, x=NULL, title=NULL, subtitle = "(d)") +
  ylim(0,15) +
   theme(plot.title = element_text(hjust = 0.5, vjust = -3, size=11), 
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_blank(), 
         axis.text.y =element_text(size=9),
         axis.title.x = element_blank(),
         axis.text.x = element_blank(),
         axis.ticks.x = element_blank(),
         legend.title = element_text(size = 10), 
         legend.key.size = unit(0.07, 'in'), legend.text = element_text(size=9), legend.position = "none",
         plot.margin = margin(c(0,0,0,0), unit="cm"))

```


#### Stability

```{r}

SA_bathy <- approx.bathy(Zmax = 12, lkeArea= 7200000, Zmean = 8, method = "voldev", zinterval = 0.5) #Approximates bathymetry (Cone or Voldev)
names(SA_bathy)[2] <- "areas" #Needs this column name to work with rlakeanalyzer

SA_Schmidt <- SA_Profiler %>%
  select(Depth, Date, Temp_C, Month, Day, Year, Group) %>%
  group_by(Date, Group) %>%
  mutate(SS = schmidt.stability(wtr = Temp_C, depths = Depth, bthA = SA_bathy$areas, bthD = SA_bathy$depths)) %>%
  select(Date, SS, Group) %>%
  unique()

SA_SS <- SA_Schmidt %>%
  filter(SS > -100) %>%
  ggplot(aes(x=Date, y=SS, group=Group)) +
   annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-07-11"), ymin = 0, ymax = 100,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-07-11"), xmax = as.Date("2021-07-15"), ymin = 0, ymax = 100,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-07-15"), xmax = as.Date("2021-07-27"), ymin = 0, ymax = 100,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-07-27"), xmax = as.Date("2021-08-16"), ymin = 0, ymax = 100,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-08-17"), xmax = as.Date("2021-08-27"), ymin = 0, ymax = 100,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-27"), xmax = as.Date("2021-10-31"), ymin = 0, ymax = 100,
           fill = "grey98") +
  geom_line()+
  theme_classic()+ 
  labs(y= NULL, x=NULL, subtitle = "(f)", title=NULL) +
  ylim(0,100)+
  theme(plot.title = element_text(hjust = 0.5, vjust = -3, size=11), 
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_blank(), 
         axis.text.y =element_text(size=9),
         axis.title.x = element_blank(),
         axis.text.x = element_blank(),
         axis.ticks.x = element_blank(),
         legend.title = element_text(size = 10), 
         legend.key.size = unit(0.07, 'in'), legend.text = element_text(size=9), legend.position = "none",
         plot.margin = margin(c(0,0,0,0), unit="cm"))
```

#### Stream Gauge Flow
```{r}

SA_SF_MR <- dataRetrieval::importRDB1("https://nwis.waterservices.usgs.gov/nwis/iv/?sites=04292750&parameterCd=00060&startDT=2017-06-01T00:00:00.000-04:00&endDT=2021-10-31T23:59:59.999-04:00&siteStatus=all&format=rdb")  %>%
  mutate(Year = year(datetime),
         Month = month(datetime),
         Day = day(datetime)) %>%
  dplyr::group_by(Day, Month, Year) %>%
  dplyr::summarise(Avg_SF = mean(X67354_00060)) %>%
  mutate(Date = make_date(Year, Month, Day)) %>%
  filter(Month >= 6 & Month <= 11)

SA_SF_JB <- dataRetrieval::importRDB1("https://nwis.waterservices.usgs.gov/nwis/iv/?sites=04292810&parameterCd=00060&startDT=2017-06-01T00:00:00.000-04:00&endDT=2021-10-31T23:59:59.999-04:00&siteStatus=all&format=rdb")  %>%
  mutate(Year = year(datetime),
         Month = month(datetime),
         Day = day(datetime)) %>%
  dplyr::group_by(Day, Month, Year) %>%
  dplyr::summarise(Avg_SF = mean(X67363_00060)) %>%
  mutate(Date = make_date(Year, Month, Day)) %>%
  filter(Month >= 6 & Month <= 11)


Precip_Data_SA <- full_join(SA_SF_MR, SA_SF_JB) %>%
  group_by(Day, Month, Year, Date) %>%
  summarise(Sum_SF = sum(Avg_SF))


SA_SF <- Precip_Data_SA %>%
  filter(Year == 2021) %>%
  ggplot(aes(x=Date, y=Sum_SF))+
 annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-07-11"), ymin = 0, ymax = 350,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-07-11"), xmax = as.Date("2021-07-15"), ymin = 0, ymax =350,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-07-15"), xmax = as.Date("2021-07-27"), ymin = 0, ymax = 350,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-07-27"), xmax = as.Date("2021-08-16"), ymin = 0, ymax = 350,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-08-16"), xmax = as.Date("2021-08-27"), ymin = 0, ymax = 350,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-27"), xmax = as.Date("2021-10-31"), ymin = 0, ymax = 350,
           fill = "grey98") +
  geom_line()+
  theme_classic()+ 
  labs(y= NULL, x=NULL, subtitle = "(j)", title=NULL) +
  ylim(0,350)+
  theme(plot.title = element_text(hjust = 0.5, vjust = -3, size=11), 
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_blank(), 
         axis.text.y =element_text(size=9),
         axis.title.x = element_blank(),
         axis.text =element_text(size=9),
         legend.title = element_text(size = 10), 
         legend.key.size = unit(0.07, 'in'), legend.text = element_text(size=9), legend.position = "none",
         plot.margin = margin(c(0,0,0.5,0), unit="cm"))
```


#### Wind Speed and Direction
```{r}
SA_Met <- read_csv("./Clean Data/SA_Met_Clean.csv") %>%
  select(Year, Month, Day, Datetime, Wind_Dir, Wind_Speed_m.s) %>%
  filter(Year == 2021) %>%
  mutate(Date = make_date(Year, Month, Day))


dat <- SA_Met %>%
  mutate(Radians = Wind_Dir * (pi/180)) %>%
  group_by(Date) %>%
  summarise(Wind_Speed = mean(Wind_Speed_m.s),
            Wind_Direction = mean(Wind_Dir), 
            Month = mean(Month)) %>%
  filter(Wind_Speed > 0)

SA_Wind <- dat %>%
  filter(Month>=6 & Month < 11) %>%
  ggplot(aes(x=Date, y=Wind_Speed)) +
 annotate("rect", xmin = as.Date("2021-06-01"), xmax = as.Date("2021-07-11"), ymin = 0, ymax = 8,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-07-11"), xmax = as.Date("2021-07-15"), ymin = 0, ymax =8,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-07-15"), xmax = as.Date("2021-07-27"), ymin = 0, ymax = 8,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-07-27"), xmax = as.Date("2021-08-16"), ymin = 0, ymax = 8,
           fill = "grey98") +
  annotate("rect", xmin = as.Date("2021-08-16"), xmax = as.Date("2021-08-27"), ymin = 0, ymax = 8,
           fill = "grey91") +
  annotate("rect", xmin = as.Date("2021-08-27"), xmax = as.Date("2021-10-31"), ymin = 0, ymax = 8,
           fill = "grey98") +
  geom_line(alpha=0.7) + 
  geom_text(aes(angle=-Wind_Direction+90), label=expression(paste("\U27A4")), color="black", size=3) +
  theme_classic() +
  labs(x=NULL, y=NULL, subtitle="(h)", title=NULL) +
  ylim(0,8) +
  theme(plot.title = element_text(hjust = 0.5, vjust = -3, size=11), 
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_blank(), 
         axis.text.y =element_text(size=9),
         axis.title.x = element_blank(),
         axis.text.x = element_blank(),
         axis.ticks.x = element_blank(),
         legend.title = element_text(size = 10), 
         legend.key.size = unit(0.07, 'in'), legend.text = element_text(size=9), legend.position = "none",
         plot.margin = margin(c(0,0,0,0), unit="cm"))
  
  
SA_Temp_DO_SS_Wind_SF <- ggarrange(SA_Temp, SA_DO, SA_SS, SA_Wind, SA_SF, align="v", ncol=1, nrow=5)

```
# Combine Both Figures Together: 

```{r}


Met_Figure <- ggarrange(MB_Temp_DO_SS_Wind_SF, SA_Temp_DO_SS_Wind_SF, align="hv", ncol=2, nrow=1)

ggsave("Met_Figure.tiff", plot=Met_Figure, device="tiff", width=8, height=10, units="in", dpi=600)


```


# Manuscript Figure 5: 
A-C; 

```{r}
Toxins <- All_Combined %>%
  select(Anatoxin, Microcystin, Date, Station) %>%
  na.omit()

CN <- All_Combined %>%
  select(CN, Date, Station) %>%
  na.omit()

Toxins_CN <- full_join(Toxins, CN)
  labs(y= "Water Temperature (C)", x=NULL, title="Missisquoi Bay", subtitle = "(a)") +
   theme(plot.title = element_text(hjust = 0.5, vjust = -3, size=11), 
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_text(size=10), 
         axis.text.y =element_text(size=9),
         axis.title.x = element_blank(),
         axis.text.x = element_blank(),
         axis.ticks.x = element_blank(),
         legend.title = element_text(size = 10), 
         legend.key.size = unit(0.07, 'in'), legend.text = element_text(size=9), legend.position = "none",
         plot.margin = margin(c(0,0.2,0,0), unit="cm"))



MC_CN <- Toxins_CN %>%
  mutate(Toxin = if_else(Microcystin > 0 & Anatoxin == 0, "MC", "None"), 
         Toxin = if_else(Anatoxin > 0 & Microcystin == 0, "ATX", Toxin),
         Toxin = if_else(Anatoxin > 0 & Microcystin > 0, "Both", Toxin)) %>%
  ggplot(aes(x=as.Date(Date), y=CN, group=Station, linetype=Station)) +
  annotate("text", x = as.Date("2021-06-02"), y = 7.75, label = "N-Replete", size = 2.5, color="dodgerblue4") +
  annotate("text", x = as.Date("2021-06-04"), y = 12.8, label = "N-Stressed", size = 2.5, color="mediumpurple4") +
  annotate("text", x = as.Date("2021-06-02"), y = 15.45, label = "N-Deplete", size = 2.5, color="indianred4") +
  geom_hline(yintercept = 8.3, linetype=3, color="dodgerblue4", linewidth=0.25) +
  geom_hline(yintercept = 14.6, linetype=3, color="indianred4", linewidth=0.25) +
  geom_line(size=0.5) +
  geom_point(aes(color=Toxin), size=0.75) +
  theme_classic() +
  scale_color_manual(values=c("orangered3", "darkmagenta", "dodgerblue3", "black")) +
  labs(y= "Seston C:N", x=NULL,  subtitle = "(a)", title=NULL) +
  theme(plot.title = element_blank(),
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_text(size=10), 
         axis.text.y =element_text(size=9),
         axis.title.x = element_blank(),
         axis.text.x = element_blank(),
         axis.ticks.x = element_blank(),
         legend.position = "none",
        legend.margin = margin(c(0,0,0,0), unit="cm"),
         plot.margin = margin(c(0,0.2,0,0), unit="cm")) +
  scale_x_date(breaks = scales::breaks_pretty(6), limits = c(as.Date("2021-05-20"), as.Date("2021-10-31")))

###### MC compared to C:P per NBay

CP <- All_Combined %>%
  mutate(CP = SestonC_uML/SestonP_uML) %>%
  select(CP, Date, Station) %>%
  na.omit()

Toxins_CP <- full_join(Toxins, CP)

MC_CP <- Toxins_CP %>%
  mutate(Toxin = if_else(Microcystin > 0 & Anatoxin == 0, "MC", "None"), 
         Toxin = if_else(Anatoxin > 0 & Microcystin == 0, "ATX", Toxin),
         Toxin = if_else(Anatoxin > 0 & Microcystin > 0, "Both", Toxin)) %>%
  ggplot(aes(x=as.Date(Date), y=CP, group=Station, linetype=Station)) +
  annotate("text", x = as.Date("2021-06-02"), y = 100, label = "P-Replete", size = 2.5, color="dodgerblue4") +
  annotate("text", x = as.Date("2021-06-03"), y = 230, label = "P-Stressed", size = 2.5, color="mediumpurple4") +
  annotate("text", x = as.Date("2021-06-02"), y = 570, label = "P-Deplete", size = 2.5, color="indianred4") +
  geom_hline(yintercept = 129, linetype=3, color="dodgerblue4", linewidth=0.25) +
  geom_hline(yintercept = 258, linetype=3, color="indianred4", linewidth=0.25) +
  geom_line(size=0.5) +
  geom_point(aes(color=Toxin), size=0.75) +
  scale_color_manual(values=c("orangered3", "darkmagenta", "dodgerblue3", "black")) +
  theme_classic() +
  labs(y= "Seston C:P", x=NULL,  subtitle = "(b)", title=NULL) +
  theme(plot.title = element_blank(),
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_text(size=10), 
         axis.text.y =element_text(size=9),
         axis.title.x = element_blank(),
         axis.text.x = element_blank(),
         axis.ticks.x = element_blank(),
         legend.position = "none",
        legend.margin = margin(c(0,0,0,0), unit="cm"),
         plot.margin = margin(c(0,0.2,0,0), unit="cm")) +
  scale_x_date(breaks = scales::breaks_pretty(6), limits = c(as.Date("2021-05-20"), as.Date("2021-10-31")))

###### MV compared to N:P per NBay

NP <- All_Combined %>%
  mutate(NP = N_uML/SestonP_uML) %>%
  select(NP, Date, Station) %>%
  na.omit()

Toxins_NP <- full_join(Toxins, NP)

MC_NP <- Toxins_NP %>%
  mutate(Toxin = if_else(Microcystin > 0 & Anatoxin == 0, "MC", "None"), 
         Toxin = if_else(Anatoxin > 0 & Microcystin == 0, "ATX", Toxin),
         Toxin = if_else(Anatoxin > 0 & Microcystin > 0, "Both", Toxin)) %>%
  ggplot(aes(x=as.Date(Date), y=NP, group=Station, linetype=Station)) +
  annotate("text", x = as.Date("2021-06-02"), y = 17, label = "N-Deplete", size = 2.5, color="dodgerblue4") +
  annotate("text", x = as.Date("2021-06-02"), y = 97, label = "P-Deplete", size = 2.5, color="indianred4") +
  geom_hline(yintercept = 22, linetype=3, color="dodgerblue4", linewidth=0.25) +
  geom_line(size=0.5) +
  geom_point(aes(color=Toxin), size=0.75) +
  scale_color_manual(values=c("orangered3", "darkmagenta", "dodgerblue3", "black")) +
  theme_classic() +
  ylim(0,100)+
  labs(y= "Seston N:P", x=NULL,  subtitle = "(c)", title=NULL) +
  theme(plot.title = element_blank(),
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_text(size=10), 
         axis.text.y =element_text(size=9),
         axis.title.x = element_blank(),
         axis.text.x = element_blank(),
         axis.ticks.x = element_blank(),
         legend.title = element_text(size = 10), 
         legend.key.size = unit(0.07, 'in'), 
         legend.key.spacing.x = unit(0.091, "in"),
         legend.text = element_text(size=9),
         legend.position = c(.75, 0.88), 
        legend.margin = margin(c(0,0,0,0), unit="cm"),
         legend.box = "horizontal",
         plot.margin = margin(c(0,0.2,0,0), unit="cm")) +
  scale_x_date(breaks = scales::breaks_pretty(6), limits = c(as.Date("2021-05-20"), as.Date("2021-10-31")))



```


D-F; 
```{r}


DN_DIN <- Nut_Toxins %>%
  na.omit() %>%
  ggplot() +
  annotate("text", x = as.Date("2021-06-02"), y = 2500, label = "N-Replete", size = 2.5, color="dodgerblue4") +
  annotate("text", x = as.Date("2021-06-02"), y = 3, label = "N-Deplete", size = 2.5, color="indianred4") +
  geom_hline(yintercept = 100, linetype=3, color="black", linewidth=0.25) +
  geom_line(aes(x = as.Date(date), y = DIN, linetype=site, group = interaction(depth, site)), size = 0.5) + 
  geom_point(aes(x = as.Date(date), y = DIN,  shape=depth, fill=Toxin, color=Toxin, group= interaction(depth, site)), size=0.75) +
  scale_shape_manual(values=c(21, 22))+
  scale_linetype_manual(values=c(1,2), guide="none")+
  scale_fill_manual(values=c("orangered3", "darkmagenta", "dodgerblue3", "black", "grey"), guide="none") +
  scale_color_manual(values=c("orangered3", "darkmagenta", "dodgerblue3", "black", "grey"), guide="none") +
  theme_classic() +
  theme_classic() +
  labs(y= expression(paste("DIN (",~ mu, "g/L)")), x=NULL,  subtitle = "(d)", title=NULL, shape="Depth", linetype=NULL, color=NULL) +
  theme(plot.title = element_blank(),
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_text(size=10), 
         axis.title.x = element_blank(),
         axis.text =element_text(size=9),
         legend.position = "none",
        legend.margin = margin(c(0,0,0,0), unit="cm"),
         plot.margin = margin(c(0,0.2,0,0), unit="cm")) +
  scale_y_continuous(trans='log2', limits = c(3, 2500), breaks=c(3, 25, 50, 100, 250, 500, 1000, 2000)) +
  scale_x_date(breaks = scales::breaks_pretty(6), limits = c(as.Date("2021-05-20"), as.Date("2021-10-31")))


DN_PO4 <- Nut_Toxins %>%
    na.omit() %>%
  ggplot() +
  annotate("text", x = as.Date("2021-06-02"), y = 20, label = "P-Replete", size = 2.5, color="dodgerblue4") +
  annotate("text", x = as.Date("2021-06-02"), y = 6, label = "P-Deplete", size = 2.5, color="indianred4") +
  geom_hline(yintercept = 10, linetype=3, color="black", linewidth=0.25) +
  geom_line(aes(x = as.Date(date), y = PO4, linetype=site, group = interaction(depth, site)), size = 0.5) + 
  geom_point(aes(x = as.Date(date), y = PO4,  shape=depth, fill=Toxin, color=Toxin, group= interaction(depth, site)), size=0.75) +
  scale_shape_manual(values=c(21, 22))+
  scale_linetype_manual(values=c(1,2), guide="none")+
  scale_fill_manual(values=c("orangered3", "darkmagenta", "dodgerblue3", "black", "grey"), guide="none") +
  scale_color_manual(values=c("orangered3", "darkmagenta", "dodgerblue3", "black", "grey"), guide="none") +
  theme_classic() +
  theme_classic() +
  ylim(0,20)+
  labs(y= expression(paste("PO4 (",~ mu, "g/L)")), x=NULL,  subtitle = "(e)", title=NULL, shape="Depth", linetype=NULL, color=NULL) +
  theme(plot.title = element_blank(),
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_text(size=10), 
         axis.title.x = element_blank(),
         axis.text =element_text(size=9),
         legend.position = "none",
        legend.margin = margin(c(0,0,0,0), unit="cm"),
         plot.margin = margin(c(0,0.2,0,0), unit="cm")) +
  scale_y_continuous(trans='log2', limits = c(0.1, 20), breaks=c(0.1, 0.5, 1, 2, 3,  5, 10, 20)) +
  scale_x_date(breaks = scales::breaks_pretty(6), limits = c(as.Date("2021-05-20"), as.Date("2021-10-31")))


DN_DIN.TP <- Nut_Toxins %>%
  na.omit() %>%
  mutate(DIN.TP = DIN/TP) %>%
  ggplot() +
  annotate("text", x = as.Date("2021-06-02"), y = 200, label = "P-Deplete", size = 2.5, color="indianred4") +
  annotate("text", x = as.Date("2021-06-02"), y = 0.3, label = "N-Deplete", size = 2.5, color="indianred4") +
  geom_hline(yintercept = 1.6, linetype=3, color="black", linewidth=0.25) +
  geom_line(aes(x = as.Date(date), y = DIN.TP, linetype=site, group = interaction(depth, site)), size = 0.5, show.legend = FALSE) + 
  geom_point(aes(x = as.Date(date), y = DIN.TP,  shape=depth, fill=Toxin, color=Toxin, group= interaction(depth, site)), size=0.75) +
  scale_shape_manual(values=c(21, 22))+
  scale_linetype_manual(values=c(1,2), guide="none")+
  scale_fill_manual(values=c("orangered3", "darkmagenta", "dodgerblue3", "black", "grey"), guide="none") +
  scale_color_manual(values=c("orangered3", "darkmagenta", "dodgerblue3", "black", "grey"), guide="none") +
  theme_classic() +
  labs(y= "DIN:TP", x=NULL,  subtitle = "(f)", title=NULL, shape="Depth", linetype=NULL, color=NULL) +
  theme(plot.title = element_blank(),
         plot.subtitle = element_text(size=10, hjust=0, vjust = -0.5),
         axis.title.y = element_text(size=10), 
         axis.title.x = element_blank(),
         axis.text =element_text(size=9),
         legend.title = element_text(size = 10), 
         legend.key.size = unit(0.07, 'in'), 
         legend.key.spacing.x = unit(0.01, "in"),
         legend.text = element_text(size=9),
         legend.position = c(.8, .92),
        legend.margin = margin(c(0,0,0,0), unit="cm"),
         plot.margin = margin(c(0,0.2,0,0), unit="cm")) +
  scale_y_continuous(trans='log2', limits = c(0.1, 205), breaks=c(0.1, 0.5, 1, 1.6, 5, 10, 25, 75)) +
  scale_x_date(breaks = scales::breaks_pretty(6), limits = c(as.Date("2021-05-20"), as.Date("2021-10-31")))

P1 <- ggarrange(MC_CN, DN_DIN,  ncol=1, nrow=2, align="v")
  
P2 <- ggarrange(MC_CP, DN_PO4, ncol=1, nrow=2, align="v")
  
P3 <- ggarrange(MC_NP, DN_DIN.TP, ncol=1, nrow=2, align="v")

#DN- ggarrange(DN_DIN, DN_PO4, DN_DIN.TP, ncol=3, nrow=1, align="h")


#Ses <- ggarrange(MC_CN, MC_CP, MC_NP, ncol=3, nrow=1,align="h")

Fig <- ggarrange(P1, P2, P3, align="h", nrow=1, ncol=3)

ggsave("Nutrient_Fig.tiff", plot=Fig, device="tiff", width=8, height=5, units="in", dpi=600)


```


# Temperature vs. Cyanotoxins: 


```{r}

MB_Toxins <- Toxins %>%
  filter(Station == "MB")

SA_Toxins <- Toxins %>%
  filter(Station == "SA")

MB_Temp_Tox <- full_join(MB_Profiler, MB_Toxins) %>%
  na.omit()

SA_Temp_Tox <- full_join(SA_Profiler, SA_Toxins) %>%
  na.omit()


MB_Temp_Tox %>%
  filter(Temp_C < 100) %>%
  group_by(Date) %>%
  summarise(Temp_C = mean(Temp_C),
            Microcystin = mean(Microcystin),
            Anatoxin = mean(Anatoxin)) %>%
  ggplot(aes(x=Temp_C, y=Microcystin))+
  geom_point()+
  theme_classic()

MB_Temp_Tox %>%
  filter(Temp_C < 100) %>%
  group_by(Date) %>%
  summarise(Temp_C = mean(Temp_C),
            Microcystin = mean(Microcystin),
            Anatoxin = mean(Anatoxin)) %>%
  ggplot(aes(x=Temp_C, y=Anatoxin))+
  geom_point()+
  theme_classic()


SA_Temp_Tox %>%
  filter(Temp_C < 100) %>%
  ggplot(aes(x=Temp_C, y=Microcystin, color=as.character(Depth)))+
  geom_point()+
  theme_classic()

SA_Temp_Tox %>%
  filter(Temp_C < 100) %>%
  ggplot(aes(x=Temp_C, y=Anatoxin, color=as.character(Depth)))+
  geom_point()+
  theme_classic()



cor(SA_Temp_Tox$Anatoxin, SA_Temp_Tox$Temp_C)
cor(SA_Temp_Tox$Microcystin, SA_Temp_Tox$Temp_C)

cor(MB_Temp_Tox$Anatoxin, MB_Temp_Tox$Temp_C)
cor(MB_Temp_Tox$Microcystin, MB_Temp_Tox$Temp_C)


```

Toxin concentration occurred at much warmer temperatures in St. Albans compared to Missisquoi Bay. In St. Albans Bay, cyanotoxin concentrations typically occurred between 20-25 C, while in Missisquoi Bay, most toxin concentrations were above zero during 15-20 C. 
